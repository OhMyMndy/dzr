<img width=600 src=.logo.svg>

# Foreplay

If you analised a somehow the HTML5 player behavior,
you should have noticed that all it played tracks
are available in the network tab of your browser debugger.

Funny thing, you can even download them cookie-less.
The questions are how this URL was generated ?
And why my audio player cannot play them ?

The keys to theses questions are in your debugger.

# So where are my keys ?

First take a look at the scripts from the network tab of your debugger.
They all are minified/webpacked, but you can lint them
and see that one (legacy.js) has an interesting long line `decodeURICompoenent("var`.
This line is in fact a full script started as a webworker.
Having coded in such shady way should give you some hint about what's inside.

If we take a quick look at all the string in this webworker file we can find some typo (`AES must be instanitated`)
This traceback to https://github.com/ricmoo/aes-js/blob/7c9fad4add4b349dcb89a4e2125f37defaef3bc8/index.js

Anyway this worker seems to be using a JS lib to aes encrypt/decrypt. we can have a lot at the source if we need inspiration/reference.
Note that the first line of this worker code is a symbol table, a technic that (cpu intensively) obfuscate your code.
A few lines later we got the table resolver, this function is called each time the script need to call a names function.

## The CDN URL Generation

Since the long hash to the CDN we found earlier in the network log was not part of any JSON,
it's fair to assert that it was generated by the player.
By looking at the aes-js code we can see that we should have an 'encrypt' function available.
Let's have a conditional breakpoint on the resolver to when it will resolve to 'encrypt'.
After pressing play on the HTML5 player, out "encrypt" breakpoint is trigged. bingo !
Now let's take a look at the function scope values we have : cdn, format, id and md5.
That's probably all it take to generate the CDN url to the track file.
A closer look to the AES cyphering scope will give us the key (16 bytes long) https://imgur.com/I1mdGGj.png used for the AES encryption.
Congratulation, you just found the AES key, aka the "Joe" key.

## The CDN File deciphering

For this part, having a logpoint while playing a track will give you a nice overview of what function are in charge of the deciphering.
You can then, traceback those name to they function and have a look at they scope.
you shall see available deciphers but also the used keys.
The keys are demuxed into 2 arrays of 8Bytes and reversed, because that's how the player is designed.
Congratulation you just got the Blowfish/CBC key, aka the "GaÃ«l" key.


